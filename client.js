window.colors={driver:new THREE.Color(16711680),marine:new THREE.Color(1430198),aviation:new THREE.Color(38143),rail:new THREE.Color(16760832),cars:new THREE.Color(15090621),space:new THREE.Color(255/181,0,1),empty:new THREE.Color(1,1,1)},window.tools={degreeToVec3:function(e,n,t,i){e=THREE.Math.degToRad(e),n=THREE.Math.degToRad(0-n);var o=1/298.257223563,a=Math.cos(e),r=Math.sin(e),d=Math.pow(1-o,2),l=1/Math.sqrt(Math.pow(a,2)+d*Math.pow(r,2)),c=l*d,s=(i*l+t)*a*Math.cos(n),u=(i*l+t)*a*Math.sin(n),m=(i*c+t)*r;return new THREE.Vector3(s,m,u)},vec3ToDeg:function(e,n){return{lat:90-180*Math.acos(e.y/n)/Math.PI,lon:(270+180*Math.atan2(e.x,e.z)/Math.PI)%360-180}},distance:function(e,n,t){var i=6378.137,o=(n[1]-e[1])*Math.PI/180,a=(n[0]-e[1])*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e[0]*Math.PI/180)*Math.cos(n[1]*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2),d=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),l=i*d;switch(t){case"nm":case"nmi":return.539956803*l;case"km":return l;case"m":default:return 1e3*l}},getDate:function(e){}},function(){var e=function(e,n){var t="Helvetica neue",i=18*window.devicePixelRatio,o=5*window.devicePixelRatio,a=10*window.devicePixelRatio,r=document.createElement("canvas");r.width=256*window.devicePixelRatio,r.height=256*window.devicePixelRatio;var d=r.getContext("2d");d.font="Bold "+i+"px "+t;var l=d.measureText(e),c=l.width,s=1.4*i,u=r.width/2-c/2-a,m=r.height/2-s/2-o;d.fillStyle="black",d.fillRect(u,m,c+2*a,s+2*o),d.fillStyle="white",d.fillText(e,u+a,r.height/2+o);var v=new THREE.Texture(r);v.needsUpdate=!0;var w=new THREE.SpriteMaterial({map:v,color:16777215}),f=new THREE.Sprite(w),h=.02;return f.scale.set(256*h,256*h,256*h),f.needsUpdate=!0,f.frustumCulled=!1,f.position.copy(n),f},n={};for(var t in window.colors){var i=window.colors[t];n[t]={},n[t].line=new THREE.MeshLineMaterial({color:i.clone(),lineWidth:.2,opacity:1,transparent:!0,resolution:new THREE.Vector2(window.innerWidth,window.innerHeight)}),n[t].bullit=new THREE.MeshBasicMaterial({color:i.clone()})}window.Route=function(t){var i=(THREE.Math.generateUUID(),[]),o=[],a=[],r=!1,d=0,l=function(){return i.length>0?i[i.length-1].clone():new THREE.Vector3};this.add=function(n,r,d,c,s){var u=l(),m=tools.degreeToVec3(n,r,.35,t.radius);if(i.push(m),d){var v=u.clone().lerp(m,.5);v=new THREE.Vector3(0,0,0).lerp(v,1+d/10);var w=new THREE.QuadraticBezierCurve3(u,v,m);o.push(w)}if(c){s=s||.1;var f=new THREE.Vector3(0,0,0).lerp(m,1+s),h=e(c,f);a.push(h),t.rotated.add(h)}return this},this.addPoint=function(n,o,r,d){var l=tools.degreeToVec3(n,o,.35,t.radius);if(i.push(l),r){d=d||.1;var c=new THREE.Vector3(0,0,0).lerp(l,1+d),s=e(r,c);a.push(s),t.rotated.add(s)}return this},this.build=function(e,r){e=e||"driver",r=r||30,o.forEach(function(i){var o=i.getPoints(r),d=new THREE.Geometry;d.vertices=o,d.verticesNeedUpdate=!0,d.lineDistancesNeedUpdate=!0;var l=new THREE.MeshLine;l.setGeometry(d);var c=new THREE.Mesh(l.geometry,n[e].line);a.push(c),t.rotated.add(c)}),i.forEach(function(i,o){var r=new THREE.SphereGeometry(.1,12,12),d=new THREE.Mesh(r,n[e].bullit);d.position.copy(i),a.push(d),t.rotated.add(d)})},this.track=function(e){return r=!0,d=e,this},this.update=function(){},this.remove=function(){return a.forEach(function(e){t.rotated.remove(e),e.geometry.dispose()}),i=void 0,o=void 0,a=void 0,this}}}(),function(){window.Timeline=function(e){var n,t,i,o,a=[],r={min:void 0,max:void 0},d=[120,5e3],l=[],c=(new Tweenable,0),s=!1,u=function(e,n){return e[2]<n[2]?"before":e[2]>n[2]&&e[1]<n[1]?"before":e[2]>n[2]&&e[1]>n[1]&&e[0]<n[0]?"before":e[2]===n[2]&&e[1]===n[1]&&e[0]===n[0]?(console.warn("equal date"),"equal"):"after"},m=function(e,t){if(0===c){if(0===t)return d[0];var i=document.querySelector(e.marker().content);return i.getBoundingClientRect().top+document.body.scrollTop}var o=e.date[2]+(30*(e.date[1]-1)+e.date[0])/356;return n(o)},v=function(){a.forEach(function(e){var n=e.date;r.min&&"before"!==u(n,r.min)||(r.min=n),r.max&&"after"!==u(n,r.max)||(r.max=n)});var e=(r.min[2]+(30*(r.min[1]-1)+r.min[0])/356,r.max[2]+(30*(r.max[1]-1)+r.max[0])/356,d3.extent(a,function(e){return e.date[2]+(30*(e.date[1]-1)+e.date[0])/356}));n=d3.scale.linear().domain(e).range(d)},w=function(){for(var e=document.querySelectorAll(".timeline__point"),n=0;n<e.length;n++)e[n].removeAttribute("cy")},f=function(){a.forEach(function(e,n){var t=m(e,n),i=t+20,o=i,a=e.marker().content;a&&0===c&&(a=document.querySelector(a),o+=a.offsetHeight,a.classList.add("timeline__content--"+e.marker().type)),e.scrollBox=[t,i,o]})};this.world=function(n){return n?(e=n,this):e},this.add=function(e){return a.push(e),this},this.addList=function(e){return e.concat(e),this},this.tick=function(){a.forEach(function(e){e.active&&e.handles.onUpdate&&e.handles.onUpdate(l)}),s&&(o.scrollTop=i(+Date.now()))},this.setMarker=function(e){this.setDate(e.date)},this.setProcent=function(e){},this.setDate=function(n){this._now&&this._now[2]===n[2];0===l.length?n:l;l=n,a.forEach(function(n){var t=n.date[0]===l[0]&&n.date[1]===l[1]&&n.date[2]===l[2];n.active&&!t&&n.handles.onLeave(e),!n.active&&t&&n.handles.onActive(e),n.active=t}),this.now=l[2]+(30*(l[1]-1)+l[0])/356,this._now=l},this.switchMode=function(n){c=n,w();var i=document.querySelector(".legend"),o=document.querySelector(".timeline__switch");0===c?(document.querySelector(".timeline__content__wrapper").style.opacity=1,document.querySelector(".timeline__content__wrapper").style.display="block",e.heatmap.show(!1),i.classList.remove("show"),o.classList.remove("active")):(document.querySelector(".timeline__content__wrapper").style.opacity=0,window.setTimeout(function(){document.querySelector(".timeline__content__wrapper").style.display="none"},700),i.classList.add("show"),o.classList.add("active"),e.heatmap.show(!0));var r=m(a[a.length-1],a.length-1);document.querySelector(".timeline").style.height=r+window.innerHeight-d[0]-4,t.selectAll(".timeline__baseline").transition().duration(200).attr("y2",r),t.selectAll(".timeline__point").transition().duration(200).attr("cy",function(e,n){return m(e,n)}),t.selectAll(".timeline__year").transition().duration(200).attr("y",function(e,n){return m(e,n)}),t.selectAll(".timeline__evt-label").transition().duration(200).attr("y",function(e,n){return m(e,n)}),f()},this.build=function(){a.sort(function(e,n){return e=e.date[2]+(30*(e.date[1]-1)+e.date[0])/365,n=n.date[2]+(30*(n.date[1]-1)+n.date[0])/365,e>n?1:-1});var e=this;v();var r=d3.select(".timeline"),l=document.querySelector(".timeline");t=r.append("g");var u=65;l.style.height=d[1]+100+"px";t.append("line").attr("class","timeline__baseline").attr("x1",u).attr("x2",u).attr("y1",82).attr("y2",11190).attr("stroke","#777").attr("stroke-width",1).attr("stroke-dasharray","1,2");t.selectAll(".timeline__point").data(a).enter().append("circle").attr("class",function(e){return"timeline__point timeline__point--"+e.marker().type}).attr("r",6).attr("cx",u).attr("cy",function(e,n){return m(e,n)}).on("mousedown",function(n){e.setMarker(n)}),t.selectAll(".timeline__year").data(a).enter().append("text").attr("class",function(e){return"timeline__year timeline__year--"+e.marker().type}).attr("x",u-25).attr("y",function(e,n){return m(e,n)}).attr("fill","#777").attr("stroke","none").attr("alignment-baseline","central").attr("dominant-baseline","central").attr("text-anchor","middle").text(function(e){return e.date[2]}).on("mousedown",function(n){e.setMarker(n)}),t.selectAll(".timeline__evt-label").data(a).enter().append("text").attr("class","timeline__evt-label").attr("x",u+10).attr("y",function(e,n){return m(e,n)}).attr("stroke","none").attr("alignment-baseline","central").attr("dominant-baseline","central").text(function(e){return e.marker().name}).on("mousedown",function(n){e.setMarker(n)}),f(),this.setMarker(a[0]),this.switchMode(0);var e=this,w=document.querySelector(".timeline__scroll-down__inner");document.querySelector(".timeline__wrapper").addEventListener("scroll",function(t){var i=t.target.scrollTop+d[0];1===c&&(this.now=n.invert(i)),a.forEach(function(n){i>n.scrollBox[0]&&i<n.scrollBox[1]&&e.setMarker(n)}),i>100?w.style.opacity=0:w.style.opacity=1}.bind(this)),document.querySelector(".timeline__switch").addEventListener("click",function(n){e.switchMode(0===c?1:0)}),window.addEventListener("keydown",function(e){if(80===e.keyCode){var n=+Date.now(),t=n+66e4;i=d3.scale.linear().domain([n,t]).range([0,13e3]),s=!0,o=document.querySelector(".timeline__wrapper")}})}}}(),function(){window.TimelineEvent=function(e){var n={color:"black",icon:"none"},t={};this.date=[1,1,1800],this.handles={update:function(){},onActive:function(){},onLeave:function(){}},this.setDate=function(e,n,t){return this.date[0]=e||1,this.date[1]=n||1,this.date[2]=t||1800,this},this.marker=function(e,t,i){return e||t||i?(n.name=e,n.type=t||"none",n.content=i,this):n},this.sidebar=function(e,n,i){return e||i?(t.image=e,t.html=n,this):t},this.onActive=function(e){return this.handles.onActive=e,this},this.onLeave=function(e){return this.handles.onLeave=e,this},this.onUpdate=function(e){return this.handles.onUpdate=e,this},e.add(this)}}(),function(){window.Heatmap=function(e){var n,t=function(e,n,t){var i=n-e;return e+i*t},i=({halfday:d3.scale.linear().domain([0,12]).range(["#80e557","#54d126"]),day:d3.scale.linear().domain([12,24]).range(["#56e2a2","#28ce86"]),twodays:d3.scale.linear().domain([24,48]).range(["#4ee5e5","#29c8cc"]),week:d3.scale.linear().domain([48,168]).range(["#57afe5","#2b87cc"]),twoweeks:d3.scale.linear().domain([168,336]).range(["#566be8","#2e3dcc"]),thirtydays:d3.scale.linear().domain([336,720]).range(["#c652e2","#ae2fcc"]),fourtydays:d3.scale.linear().domain([720,960]).range(["#e856c3","#cc329d"]),big:d3.scale.linear().domain([960,1200]).range(["#e56161","#cc3333"])},function(e){return 12>e?new THREE.Color(5558566):e>12&&24>=e?new THREE.Color(2674310):e>24&&48>=e?new THREE.Color(2738380):e>48&&168>=e?new THREE.Color(2852812):e>168&&336>=e?new THREE.Color(3030476):e>336&&720>=e?new THREE.Color(11415500):e>720&&960>=e?new THREE.Color(13382301):new THREE.Color(13382451)}),o=new THREE.MeshPhongMaterial({shading:THREE.FlatShading,vertexColors:THREE.VertexColors,transparent:!0,opacity:.5}),a=new THREE.XHRLoader;a.load("data/travel-times.json",function(a){var r=new THREE.IcosahedronGeometry(e.radius+.4,6),d=JSON.parse(a),l=new THREE.Color(255,255,255);d.forEach(function(e,n){r.faces[n].color.copy(l)}),r.colorsNeedUpdate=!0;var c=new THREE.Mesh(r,o);e.scene.add(c);var s=d3.scale.linear().domain([1881,2016]).range([0,1]),u=0,m=5;e.renderManager.pipe("heatmap",function(){var e=timeline.now,a=s(e);if(e>1914&&1919>e)r.faces.forEach(function(e,n){var t=d[n].WO1,i=t?window.colors.driver:window.colors.empty;r.faces[n].color.copy(i)}),o.opacity=.3;else if(e>1939&&1945>e)r.faces.forEach(function(e,n){var t=d[n].WO2,i=t?window.colors.driver:window.colors.empty;r.faces[n].color.copy(i)}),o.opacity=.3;else if(e>=1973&&1974>e)r.faces.forEach(function(e,n){var t=d[n].oil,i=d[n].oil2,o=t?window.colors.driver:window.colors.empty;o=i?window.colors.rail:o,r.faces[n].color.copy(o)}),o.opacity=.3;else if(e>=2003&&2004>e)r.faces.forEach(function(e,n){var t=d[n].oil3,i=t?window.colors.driver:window.colors.empty;r.faces[n].color.copy(i)}),o.opacity=.3;else{if(o.opacity=n?.3:0,!n)return!1;for(var l=u;l<r.faces.length;l+=m){var c=(r.faces[l],t(d[l].travelTime[1881],d[l].travelTime[2016],a));r.faces[l].color.copy(i(c))}u++,u=u>m?0:u}r.colorsNeedUpdate=!0})}),this.show=function(e){n=e}}}(),window.World=function(){var e=document.getElementById("canvas"),n=window.devicePixelRatio=1,t=e.offsetWidth*n,i=window.innerHeight*n,o=new THREE.WebGLRenderer({antialias:!0});o.setClearColor(16777215,1),o.setSize(t,i),e.appendChild(o.domElement),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(30,t/i,1,1e3),this.camera.position.set(0,20,-30),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.rotated=new THREE.Object3D,this.rotated.rotateY(-Math.PI),this.scene.add(this.rotated),this.renderManager=new THREE.renderPipeline(o);var a=new THREE.RenderStep(t,i,this.scene,this.camera),r=new THREE.ShaderStep(t,i),d=new THREE.ShaderStep(t,i),l=new THREE.ShaderStep(t,i);new THREE.ShaderStep(t,i);r.shader("vertex",document.getElementById("copyVertex").textContent).shader("fragment",document.getElementById("copyFragment").textContent).pipe().renderToScreen();var c=.65,s=5;d.setting("v","f",s/t).setting("r","f",c).setting("spread","f",1.9).shader("vertex",document.getElementById("copyVertex").textContent).shader("fragment",document.getElementById("tiltVertiFragment").textContent).pipe(),l.setting("h","f",s/t).setting("r","f",c).setting("spread","f",1.9).shader("vertex",document.getElementById("copyVertex").textContent).shader("fragment",document.getElementById("tiltHoriFragment").textContent).pipe();var u=6;this.radius=10;var m=new THREE.XHRLoader;m.load("data/map.json",function(e){var n=new THREE.IcosahedronGeometry(this.radius,u),t=new THREE.MeshPhongMaterial({shading:THREE.FlatShading,vertexColors:THREE.VertexColors}),i=new THREE.Mesh(n,t),o=JSON.parse(e);o.forEach(function(e,t){var i=e.inside?.2:1;n.faces[t].color=new THREE.Color(i,i,i)});var a=new THREE.Vector3(0,0,0);n.vertices.forEach(function(e){var n=Math.random();e=e.lerp(a,-n/25)}),this.scene.add(i);var r=new THREE.HemisphereLight(16777215,14540253,.5),d=new THREE.PointLight(16777215,1,100),l=new THREE.PointLight(16777215,1,100);d.position.set(0,50,0),l.position.set(0,-50,0),this.scene.add(r),this.scene.add(d),this.scene.add(l),window._geom=n,window._radius=this.radius}.bind(this)),this.heatmap=new Heatmap(this);var v=new THREE.OrbitControls(this.camera,o.domElement);v.enableDamping=!0,v.dampingFactor=.2,v.rotateSpeed=.2,v.autoRotate=!0,v.autoRotateSpeed=-.1,timeline.world(this).build(),this.renderManager.pipe("main",a).pipe("tilt-h",l).pipe("tilt-v",d).pipe("toScreen",r).pipe("controls",v.update.bind(v)).pipe("timeline",timeline.tick.bind(timeline)).start(),window.addEventListener("resize",function(){n=window.devicePixelRatio=1,t=window.innerWidth-350*n,i=window.innerHeight*n,o.setSize(t,i),this.camera.aspect=t/i,this.camera.updateProjectionMatrix()}.bind(this))};var start=function(){new World;var e=document.querySelector(".info-btn"),n=document.querySelector(".info"),t=!1;e.addEventListener("click",function(){n.style.display=t?"none":"block",e.classList.toggle("close"),t=!t})};document.addEventListener("DOMContentLoaded",start),function(){var e={},n=function(e,n){return e.vertices[n]},t=function(e,n){return{lat:90-180*Math.acos(e.y/n)/Math.PI,lon:(270+180*Math.atan2(e.x,e.z)/Math.PI)%360-180}},i=function(e,n){n||(n="data.json"),e=JSON.stringify(e);var t=new Blob([e],{type:"application/json"}),i=document.createEvent("MouseEvents"),o=document.createElement("a");o.download=n,o.href=window.URL.createObjectURL(t),o.dataset.downloadurl=["application/json",o.download,o.href].join(":"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(i)};e.vertices=function(){if(!window._geom)return console.error("no geometry to export"),!1;var e=window._geom,n=window._radius,o=[];e.vertices.forEach(function(e){o.push(t(e,n))}),console.log("exported",o),i(o,"vertices.json")},e.faces=function(){if(!window._geom)return console.error("no geometry to export"),!1;var e=window._geom,o=window._radius,a=[];e.faces.forEach(function(i){var r={};r.a=t(n(e,i.a),o),r.b=t(n(e,i.b),o),r.c=t(n(e,i.c),o),a.push(r)}),console.log("exported",a),i(a,"faces.json")}}(),function(){window.timeline=new Timeline}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,1869).marker("First Transcontinental Railroad","rail",".timeline__content--first-transcontinental-railroad").onActive(function(n){e=new Route(timeline.world()),e.add(37.803939,-122.426896,void 0,"San Francisco Bay").add(41.261944,-95.860833,2).add(41.878114,-87.629798,.2,"Chicago").add(41.261944,-95.860833).add(40.712784,-74.005941,1,"New York").build("rail")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(18,11,1869).marker("Suez canal","driver",".timeline__content--suez-canal").onActive(function(n){e=new Route(timeline.world()),e.addPoint(30.510583,32.445309,"Suez Canal").build()}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,1880).marker("Immigration to USA","driver",".timeline__content--immigration").onActive(function(n){e=new Route(timeline.world()),e.add(53.408371,-2.991573,void 0,"Liverpool").add(40.712784,-74.005941,3,"New York").build("driver")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(4,10,1883).marker("Orient express","rail",".timeline__content--orient-express").onActive(function(n){e=new Route(timeline.world()),e.add(51.507351,-.127758,void 0,"London",.15).add(48.856614,2.352222,.2,"Paris").add(48.208174,16.37381,.3,"Viena").add(47.497912,19.040235,.15).add(41.008238,28.978359,.4,"Constantinople").build("rail")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,11,1884).marker("Last big steamschip with auxiliary sails","marine",".timeline__content--auxiliary-sails").onActive(function(n){e=new Route(timeline.world()),e.add(53.408371,-2.991573,void 0,"Liverpool").add(51.850336,-8.294286,.5).add(40.712784,-74.005941,3,"New York").build("marine")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(17,12,1903).marker("First flight by Wright brothers","aviation",".timeline__content--wright-brothers").onActive(function(n){e=new Route(timeline.world()),e.addPoint(36.06461,-75.705735,"Kitty Hawk").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(20,9,1906).marker("First oceanliner with steam turbine","marine",".timeline__content--steam-turbine").onActive(function(n){e=new Route(timeline.world()),e.add(50.9097,-1.404351,void 0,"Southampton").add(51.850336,-8.294286,.5).add(40.712784,-74.005941,3,"New York").build("marine")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,10,1908).marker("Ford Model T","cars",".timeline__content--model-t").onActive(function(n){e=new Route(timeline.world()),e.addPoint(42.331427,-83.045754,"Detroit").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,1911).marker("first mass produced bus","cars",".timeline__content--bus").onActive(function(n){e=new Route(timeline.world()),e.addPoint(51.507351,-.127758,"London").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,2,1912).marker("First diesel oceanliner","marine",".timeline__diesel-ship").onActive(function(n){e=new Route(timeline.world()),e.add(55.676097,12.568337,void 0,"Copenhagen").add(44.40565,8.946256,1,"Genoa").add(13.756331,100.501765,10,"Bangkok").build("marine")}).onLeave(function(){e.remove()})}(),function(){var e=new TimelineEvent(timeline);e.setDate(28,6,1914).marker("First world war","driver",".timeline__wo-1").onActive(function(e){}).onLeave(function(){})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,6,1919).marker("First transatlantic flight","aviation",".timeline__first-atlantic-flight").onActive(function(n){e=new Route(timeline.world()),e.add(47.560541,-52.712831,void 0,"St. John's").add(53.594765,-9.844777,4,"Clifden").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n,t=new TimelineEvent(timeline);t.setDate(1,1,1924).marker("Imperial Airways founded","aviation",".timeline__start-imperial-airways").onActive(function(t){e=new Route(timeline.world()),n=new Route(timeline.world()),e.add(51.507351,-.127758,void 0,"London").add(48.856614,2.352222,.4,"Paris").add(40.632728,17.941762,2,"Brindisi").add(37.983917,23.72936,.4,"Athens").add(31.128199,29.926758,1,"Alexandria").add(30.04442,31.235712,.5).add(26.863281,31.816406,.3).add(24.96614,33.706055,.3).add(23.80545,33.706055,.3).add(21.799142,31.371316,.3,"Wadi Halfa").add(19.103648,33.881836,.3).add(15.45368,32.475586,.3,"Khartoum").add(13.923404,32.585449,.3).add(4.882994,31.552734,.3,"Juba").add(.051184,32.463708,.3,"Entebbe").add(-6.162401,35.749512,.3).add(-8.885072,33.442383,.3,"Mbeya").add(-11.828023,31.451331,.3).add(-11.828023,31.451331,.3).add(-15.379543,28.33374,.3).add(-17.825166,31.03351,.3,"Harare").add(-20.159098,28.630371,.3).add(-23.885838,29.421387,.3).add(-26.165299,28.059082,.3,"Johannesburg").add(-28.719496,24.752197,.3).add(-32.008076,23.203125,.3).add(-33.92513,18.413086,.3,"Cape Town").build("aviation"),n.add(31.128199,29.926758).add(31.354676,34.308826,.3).add(33.312806,44.361488,.3,"Baghdad").add(30.508103,47.783489,.3,"Basra").add(29.31166,47.481766,.3,"Kuweit").add(26.0667,50.5577,.3,"Bahrein").add(25.322327,55.513643,.3,"Sharjah").add(25.198695,62.321315,.3,"Gwadar").add(24.861462,67.009939,.3,"Karachi").add(26.238947,73.024309,.3).add(28.613939,77.209021,.3,"Delhi").add(25.435801,81.846311,.3).add(25.435801,81.846311,.3,"Calcutta").add(20.152766,92.867686,.3,"Akyab").add(16.866069,96.195132,.3,"Rangoon").add(13.756331,100.501765,.3,"Bangkok").add(9.709057,98.657227,.3).add(5.484768,100.327148,.3,"Penang").add(1.352083,103.819836,.3,"Singapore").add(-6.208763,106.845599,.3,"Batavia").add(-7.257472,112.752088,.3).add(-8.385431,114.169922,.3).add(-10.1772,123.607033,.3).add(-12.425848,130.847168,.3,"Darwin").add(-17.476432,133.637695,.3).add(-19.062118,134.780273,.3).add(-19.890723,137.329102,.3).add(-20.704353,140.505613,.3).add(-23.440658,144.251056,.3,"Longreach").add(-27.471011,153.023449,.3,"Brisbane").build("aviation")}).onLeave(function(){e.remove(),n.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(18,9,1928).marker("First transatlantic zeppelin flight","aviation",".timeline__first-atlantic-zeppelin").onActive(function(n){e=new Route(timeline.world()),e.add(47.661765,9.480011,void 0,"Friedrichshafen").add(40.014561,-74.311257,4,"Lakehurst").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e=new TimelineEvent(timeline);e.setDate(1,11,1939).marker("Second world war","driver",".timeline__wo-2").onActive(function(e){}).onLeave(function(){})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,1946).marker("First transatlantic line flight","aviation",".timeline__first-atlantic-airline").onActive(function(n){e=new Route(timeline.world()),e.add(40.712784,-74.005941,void 0,"New York").add(51.507351,-.127758,4,"Londen").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(12,4,1961).marker("First man in space","space",".timeline__first-man-in-space").onActive(function(n){e=new Route(timeline.world()),e.add(45.623226,63.313983,void 0,"Baikonur").add(51.270682,45.99727,20).build("space")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,10,1964).marker("First bullet train","rail",".timeline__bullet-trains").onActive(function(n){e=new Route(timeline.world()),e.add(35.689487,139.691706,void 0,"Tokyo",.2).add(34.693738,135.502165,.15,"Osaka").build("rail")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(16,8,1969).marker("First man on the moon","space",".timeline__first-man-on-the-moon").onActive(function(n){e=new Route(timeline.world()),e.add(28.392218,-80.607713,void 0,"Cape Canaveral").add(13.316667,-169.15,60).build("space")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,10,1970).marker("First commercial widebody plane","aviation",".timeline__first-commercial-widebody").onActive(function(n){e=new Route(timeline.world()),e.add(51.507351,-.127758,void 0,"London").add(40.712784,-74.005941,8,"New York").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,10,1973).marker("Oil crisis","driver",".timeline__oil-cris-1973").onActive(function(n){e=new Route(timeline.world()),e.addPoint(52.370216,4.895168,"Netherlands").addPoint(38.907192,-77.036871,"United States of America").addPoint(35.689487,139.691706,"Japan").addPoint(45.42153,-75.697193,"Canada").addPoint(51.507351,-.127758,"United Kingdom",.2).addPoint(32.0853,34.781768,"Israel").addPoint(26.820553,30.802498,"Egypt").addPoint(34.802075,38.996815,"Syria",.2).addPoint(28.033886,1.659626,"Algeria").addPoint(23.424076,53.847818,"United Arab Immirates").addPoint(33.223191,43.679291,"Iraq").addPoint(29.31166,47.481766,"Kuweit").addPoint(26.3351,17.228331,"Libya").addPoint(33.886917,9.537499,"Tunesia").addPoint(18.479609,43.59375,"Saudi Arabia").build()}).onLeave(function(){e.remove()})}(),function(){var e,n,t=new TimelineEvent(timeline);t.setDate(21,1,1976).marker("Concorde","aviation",".timeline__concorde").onActive(function(t){e=new Route(timeline.world()),n=new Route(timeline.world()),e.add(51.507351,-.127758,void 0,"London").add(26.0667,50.5577,8,"Bahrein").add(51.507351,-.127758,void 0).add(-26.204103,28.047305,10,"Johannesburg").add(51.507351,-.127758,void 0).add(40.712784,-74.005941,8,"New York",.2).add(51.507351,-.127758,void 0).add(-37.788081,144.953613,100,"Melbourne").add(51.507351,-.127758,void 0).add(35.689487,139.691706,10,"Tokyo").add(51.507351,-.127758,void 0).add(1.352083,103.819836,15,"Singapore").add(51.507351,-.127758,void 0).add(38.907192,-77.036871,8,"Washington").build("aviation"),n.add(48.856614,2.352222,void 0,"Paris",.05).add(14.764504,-17.366029,6).add(-22.906847,-43.172896,6,"Rio de Janeiro").add(51.507351,-.127758,void 0).add(37.741249,-25.675594,6).add(10.480594,-66.903606,6,"Caracas").add(51.507351,-.127758,void 0).add(38.907192,-77.036871,6).add(19.432608,-99.133208,6,"Mexico City").build("aviation")}).onLeave(function(){e.remove(),n.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,1981).marker("TGV","rail",".timeline__tgv").onActive(function(n){e=new Route(timeline.world()),e.add(48.856614,2.352222,void 0,"Paris",.2).add(45.764043,4.835659,.15,"Lyon").build("rail")}).onLeave(function(){e.remove()})}(),function(){var e=new TimelineEvent(timeline),n=new THREE.Scene,t=[],i=[90,-90],o=[-180,180],a=d3.scale.linear().domain([1,5]).range(i),r=d3.scale.linear().domain([1,5]).range(o),d=new THREE.MeshBasicMaterial({color:colors.driver.clone()});e.setDate(1,12,1993).marker("GPS available for public use","driver",".timeline__gps").onActive(function(e){for(var i=1;6>i;i++)for(var o=1;6>o;o++){var l=a(i),c=r(o),s=tools.degreeToVec3(l,c,6,e.radius),u=new THREE.SphereGeometry(.2,12,12),m=new THREE.Mesh(u,d);m.position.copy(s),n.add(m),t.push(m)}e.scene.add(n)}).onUpdate(function(){n.rotation.x+=.005,n.rotation.y-=.005}).onLeave(function(e){t.forEach(function(e){n.remove(e),e.geometry.dispose()}),e.scene.remove(n)})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(14,11,1994).marker("First eurostar train through Chanel Tunnel","rail",".timeline__eurostar").onActive(function(n){e=new Route(timeline.world()),e.add(48.856614,2.352222,void 0,"Paris").add(51.507351,-.127758,.15,"London",.15).build("rail")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2003).marker("2000s energy crisis","driver",".timeline__oil-cris-2003").onActive(function(n){e=new Route(timeline.world()),e.addPoint(25.304304,-90.065918,"Golf of Mexico").addPoint(33.223191,43.679291,"Iraq").addPoint(18.479609,43.59375,"Saudi Arabia").addPoint(9.081999,8.675277,"Nigeria").addPoint(6.42375,-66.58973,"Venezuela").addPoint(61.52401,105.318756,"Russia").build()}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(26,11,2003).marker("End of supersonic commercial aviation","aviation",".timeline__end-of-supersonic-aviation").onActive(function(n){e=new Route(timeline.world()),e.add(51.507351,-.127758,void 0,"London").add(40.712784,-74.005941,1,"New York").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2004).marker("First success of hybrid car","cars",".timeline__hybrid-card").onActive(function(n){e=new Route(timeline.world()),e.addPoint(35.082395,137.156249,"Toyota").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,5,2005).marker("Launch of Google Maps","driver",".timeline__google-maps").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.386052,-122.083851,"Mountain View").build("driver")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(25,10,2007).marker("Airbus A380","aviation",".timeline__airbus-hubs").onActive(function(n){e=new Route(timeline.world()),e.add(1.352083,103.819836,void 0,"Singapore").add(-33.867487,151.20699,8,"Sydney").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,6,2008).marker("Tesla Roadstar","driver",".timeline__tesla").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.441883,-122.143019,"Palo Alto").build("driver")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,3,2010).marker("Google starts self driving car programme","cars",".timeline__google-self-driving-car").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.386052,-122.083851,"Mountain View").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,9,2010).marker("Uber beta starts","cars",".timeline__uber-beta").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.774929,-122.419416,"San Francisco").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2015).marker("Tesla Autopilot","cars",".timeline__tesla-autopilot").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.441883,-122.143019,"Palo Alto").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2019).marker("Google self driving released","cars",".timeline__google-self-driving-car-release").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.386052,-122.083851,"Mountain View").addPoint(42.331427,-83.045754,"Detroit").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n,t=new TimelineEvent(timeline),i=["New York City","London","San Francisco","Berlin","Paris","Honolulu","Chicago","Miami","Sao Paolo","Rio De Janeiro","Montevideo","Rome","Moskou","München","Tel Aviv","Dubai","Nairobi","Lagos","Capetown","Johannesburg","Beijing","Hong Kong","Taipei","Tokyo","Shanghai","Sydney","Mumbai","New Delhi","Bangkok","Singapore","Brisbane","Stockholm","Bogota","Panama","Mexico City"],o=new THREE.XHRLoader,a=function(e){o.load("data/uber.json",function(t){var i=JSON.parse(t);n=i,e&&e(n)})};a(),t.setDate(1,8,2019).marker("Uber start with self driving cars","cars",".timeline__uber-network").onActive(function(t){e=new Route(timeline.world());var o=function(n){n.forEach(function(n){var t=i.indexOf(n.city)>-1?n.city:void 0;e.addPoint(n.latitude,n.longitude,t)}),e.build("cars")};n?o(n):a(o)}).onLeave(function(){e.remove()})}(),function(){var e,n,t=new TimelineEvent(timeline),i=["New York City","London","San Francisco","Berlin","Paris","Honolulu","Chicago","Miami","Sao Paolo","Rio De Janeiro","Montevideo","Rome","Moskou","München","Tel Aviv","Dubai","Nairobi","Lagos","Capetown","Johannesburg","Beijing","Hong Kong","Taipei","Tokyo","Shanghai","Sydney","Mumbai","New Delhi","Bangkok","Singapore","Brisbane","Stockholm","Bogota","Panama","Mexico City"],o=d3.scale.linear().domain([5e3,2e4]).range([.1,75]),a=new THREE.XHRLoader,r=function(e){a.load("data/uber.json",function(t){var i=JSON.parse(t);n=i,e&&e(n)})};r(),t.setDate(1,1,2021).marker("Uber starts connecting hubs","driver",".timeline__global-uber-network").onActive(function(t){
e=new Route(timeline.world());var a=function(n){n.forEach(function(t,a){for(var r=i.indexOf(t.city)>-1?t.city:void 0,d=0;1>d;d++){d>0&&(r=void 0);var l=n[Math.floor(Math.random()*n.length)],c=window.tools.distance([t.longitude,t.latitude],[l.longitude,l.latitude],"km"),s=o(c);window.setTimeout(function(){e.add(this.point1.latitude,this.point1.longitude,void 0,r).add(this.point2.latitude,this.point2.longitude,s),this.last&&e.build("driver",10)}.bind({point1:t,point2:l,last:a===n.length-1}),0)}})};n?a(n):r(a)}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2022).marker("Silent supersonic commercial aviation","aviation",".timeline__silent-supersonic").onActive(function(n){e=new Route(timeline.world()),e.add(37.774929,-122.419416,void 0,"San Francisco").add(40.712784,-74.005941,2,"New york").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2023).marker("Self driving busses","cars",".timeline__self-driving-busses").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.774929,-122.419416,"San Francisco").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2023).marker("Car ownership is below 20%","cars",".timeline__car-ownership").onActive(function(n){e=new Route(timeline.world()),e.addPoint(37.774929,-122.419416,"San Francisco").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2028).marker("First Hyperloop track","rail",".timeline__hyperloop").onActive(function(n){e=new Route(timeline.world()),e.add(37.774929,-122.419416,void 0,"San Francisco",.15).add(34.052234,-118.243685,1,"Los Angeles").build("rail")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2025).marker("First commercial trip to space","space",".timeline__virgin-galactic").onActive(function(n){e=new Route(timeline.world()),e.addPoint(35.056235,-118.157835,"Mojave Spaceport",.15).addPoint(67.8558,20.225282,"Spaceport Sweden").addPoint(33.321349,-105.424805,"Spaceport America").addPoint(24.299174,54.697277,"Abu Dhabi Spaceport").build("aviation")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,6,2030).marker("Smart charging highways","cars",".timeline__singapore-smart-highways").onActive(function(n){e=new Route(timeline.world()),e.addPoint(1.352083,103.819836,"Singapore").build("cars")}).onLeave(function(){e.remove()})}(),function(){var e,n=new TimelineEvent(timeline);n.setDate(1,1,2040).marker("SpaceLiner suborbital lineflights","space",".timeline__spaceliner").onActive(function(n){e=new Route(timeline.world()),e.add(51.507351,-.127758,void 0,"London").add(-33.867487,151.20699,200,"Sydney").build("space")}).onLeave(function(){e.remove()})}(),function(){var e=new TimelineEvent(timeline);e.setDate(1,1,2046).marker("","default",".timeline__end").onActive(function(e){console.log("end")}).onLeave(function(){})}();